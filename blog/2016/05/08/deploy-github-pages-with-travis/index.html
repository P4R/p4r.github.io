<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Pere Albujer" />

    <title>Pere Albujer | Publicar web con Travis CI</title>
    <meta name="description" content="A los pocos días de poner la web en funcionamiento en Github Pages me di cuenta de que había que hacer algo para automatizar la publicación de contenido en l...">

    <link rel="canonical" href="http://albujer.com/blog/2016/05/08/deploy-github-pages-with-travis/">
    <link rel="alternate" type="application/rss+xml" title="Pere Albujer" href='http://albujer.com/feed.xml' />
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <!-- Chrome for Android theme color -->
    <!-- TODO: Change to match final color scheme -->
    <meta name="theme-color" content="#607D8B">

    <!-- Web Application Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Tile color for Win8 -->
    <!-- TODO: Change to match final color scheme -->
    <meta name="msapplication-TileColor" content="#FF5722">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Pere Albujer">
    <link rel="icon" sizes="192x192" href="/images/touch/chrome-touch-icon-192x192.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Pere Albujer">
    <link rel="apple-touch-icon" href="/images/touch/apple-touch-icon.png">

    <!-- Tile icon for Win8 (144x144) -->
    <meta name="msapplication-TileImage" content="/images/touch/ms-touch-icon-144x144-precomposed.png">

    <!-- Image for facebook -->
    <meta property="og:image" content="/images/logo.png" />

    <!-- build:css styles/main.css -->
    <link rel="stylesheet" href="/styles/main.css">
    <!-- endbuild-->

    <!-- build:css styles/code-highlight.css -->
    <link rel="stylesheet" href="/styles/code-highlight.css">
    <!-- endbuild-->

    <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
    <script async src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <!-- endbuild -->

    <!-- will be replaced with elements/elements.vulcanized.html -->
    <link rel="import" href="/elements/elements.html">
    <!-- endreplace-->

    <!-- For shared styles, shared-styles.html import in elements.html -->
    <style is="custom-style" include="shared-styles"></style>
</head>

<body unresolved class="fullbleed layout vertical">
<span id="browser-sync-binding"></span>
<template is="dom-bind" id="app">

  <paper-drawer-panel id="paperDrawerPanel">
    <!-- Drawer Scroll Header Panel -->
    <paper-scroll-header-panel drawer fixed>
      <div class="wrapper"> <!-- necessary to push copyright to bottom -->
        <!-- Drawer Toolbar -->
        <div class="profile-image"></div>
        <nav-image src="/images/material-bg.png" id="menu-img"></nav-image>

        <!-- Drawer Content -->
        <paper-menu class="list" attr-for-selected="data-route" selected="" on-iron-select="onMenuSelect">
          <a href="/"><iron-icon icon="home"></iron-icon><span>Inicio</span></a>
          <a href="/blog"><iron-icon icon="icons:chrome-reader-mode"></iron-icon><span>Blog</span></a>
          <a href="/projects"><iron-icon icon="icons:polymer"></iron-icon><span>Proyectos</span></a>
          
          <a href="/contact"><iron-icon icon="mail"></iron-icon><span>Contacto</span></a>
          
          <a href="/about"><iron-icon icon="social:person"></iron-icon><span>Acerca de mí</span></a>
          <a href="/archive"><iron-icon icon="history"></iron-icon><span>Archivo</span></a>
        </paper-menu>

        <my-nav-subheader></my-nav-subheader>
        <paper-menu class="list" on-iron-select="onMenuSelect">
          
          <a href="https://github.com/P4R" target="_blank"><iron-icon icon="fa:github"></iron-icon><span>Mi Github</span></a>
          
          
          <a href="http://paypal.me/PAlbujer" target="_blank"><iron-icon icon="fa:paypal"></iron-icon><span>Donaciones</span></a>
          
          <a data-route="contact" href="/feed.xml"><iron-icon icon="fa:rss"></iron-icon><span>RSS</span></a>
        </paper-menu>
        <div class="push"></div>
      </div>
      <div id="copyright-info">&copy; 2016, Pere Albujer</div>
    </paper-scroll-header-panel>

    <!-- Main Area -->
    <paper-scroll-header-panel main id="headerPanelMain" condenses keep-condensed-header condensed-header-height="56">
      <!-- Main Toolbar -->
      <paper-toolbar id="mainToolbar" class="medium-tall">
        <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle></paper-icon-button>

        <!-- Application name -->
        <div class="top top-container title">Pere Albujer</div>
        <span class="space"></span>

        <!-- Toolbar icons -->\
        <div class="top top-container">
          <my-search-bar class="top" id="search-input" searchjson="/search.json"></my-search-bar>
        </div>

        <div class="middle middle-container">
        </div>

        <!-- Application sub title -->
        <div class="bottom bottom-container">
          <!--<div class="bottom-title">El éxito depende del esfuerzo</div>-->
          <div class="bottom-title">El éxito depende del esfuerzo</div>
        </div>
      </paper-toolbar>

      <!-- Main Content -->
      <div class="content"><style>
  body {
    background-color: #f9f9f9 !important;
  }
</style>

<div id="post">

  
  <a href="/images/posts/travis.png" data-lightbox="image-1" data-title="">
    <img class="materialboxed" src="/images/posts/travis.png">
  </a>
  
  

  <!-- Translate and format date -->
  
  
  
  
  
  <h1 class="paper-font-display1">Publicar web con Travis CI</h1>
  <h4 class="paper-font-subhead" id="date">8 de Mayo de 2016</h4>

  <div id="post-content">
    <p>A los pocos días de poner la web en funcionamiento en Github Pages me di cuenta de que había que hacer algo para automatizar la publicación de contenido en la web. Tras analizar todas opciones decidí que Travis CI fuera el encargado de procesar todo el código y publicarlo la web.</p>

<!--more-->

<p>El ejemplo que voy a usar es el de mi web, así que explicare como publico el código generado por Jekyll y el descargado
de componentes web como Polymer y otros ya que estos nunca están presentes en la rama que contiene el código del proyecto.</p>

<p>A continuación podéis ver de forma mas concreta el proyecto web y una ligera explicación de como funciona
Gihub Pages. <a href="/projects/2016/04/03/personal-website/" target="_blank">Ver proyecto web</a></p>

<h4 id="requisitos">Requisitos:</h4>
<ul>
  <li>Repositorio en Github con la web.</li>
  <li>Cuenta en <a href="https://travis-ci.org/" target="_blank">Travis CI</a> (Se puede hacer login con la cuenta de Github)</li>
</ul>

<h3 id="como-funciona-travis-ci">¿Como funciona Travis CI?</h3>

<p>Travis es un sistema de integración continua el cual nos permite realizar test sobre nuestro código de Github.
En nuestro caso ademas de comprobar que todo ha funcionado bien lo vamos a utilizar para publicar el
código generado en otra rama de nuestro repositorio.</p>

<p>Travis se activa con cada push que se hace a nuestro repositorio o también con los pull request aunque esta última
opción no la vamos a utilizar.</p>

<h3 id="configuracin-travis-ci">Configuración Travis CI</h3>

<p>En primer lugar debemos obtener un token de Github para poder hacer push desde Travis, el token lo podemos obtener
desde <a href="https://github.com/settings/tokens" target="_blank">aquí</a></p>

<p>A continuación accederemos a la web de Travis donde lo autorizaremos para acceder a nuestro repositorio.</p>

<p><img src="/images/posts/travis-active-repo.jpg" /></p>

<p>Una vez autorizado pasaremos configurar el repositorio en Travis mediante el botón de ajustes, deberemos
activar las opciones que aparecen en la siguiente imagen y añadiremos una variable de entorno llamada
GH_TOKEN donde pondremos el token obtenido en Github <strong>(Importante marcar el token como oculto/privado
para que nadie lo pueda ver y utilizar)</strong>.</p>

<p><img src="/images/posts/travis-config-repo.jpg" /></p>

<p>Una vez este todo configurado solo tenemos que añadir el fichero de Travis y el script que ejecutaremos en
nuestro repositorio de Github.</p>

<h5 id="travisyml">.travis.yml</h5>

<p>Como se puede ver en este fichero especificaremos todo lo necesario para poder ejecutar nuestro código. En
mi caso simplemente necesitaré Node.js y Ruby. Además especificaré el script que se tendrá que ejecutar,
en este caso Travis actuara en todas las ramas que contengan este archivo pero podríamos limitar las ramas
en el archivo de configuración.</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">language</span><span class="pi">:</span> <span class="s">node_js</span>
<span class="s">node_js</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">0.12.2</span>
<span class="s">before_install</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">rvm install 2.2.2</span>
<span class="s">script</span><span class="pi">:</span> <span class="s">bash ./deploy.sh</span></code></pre></figure>

<h5 id="deploysh">deploy.sh</h5>

<p>Este script simplemente ejecutará todas las instrucciones necesarias para obtener el código de la
web y si todo va bien se configurará un usuario de git (Se puede modificar el email por el nuestro
de Github para que se asocie el commit a nuestra cuenta) que sera el encargado de subir los cambios
a la rama en la cual se publica la web que en este caso es master pero en otros podría ser gh-pages.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="nb">set</span> -e <span class="c"># exit with nonzero exit code if anything fails</span>

gem install bundler
bundle install

<span class="c"># Add source from master branch</span>
git clone https://github.com/P4R/p4r.github.io.git -b master dist

<span class="c"># Run commands to build the website in the dist folder</span>
npm install -g gulp bower <span class="o">&amp;&amp;</span> npm install <span class="o">&amp;&amp;</span> bower install
gulp

<span class="c"># Go to the dist directory.</span>
<span class="nb">cd </span>dist

<span class="c"># Inside this git repo we'll pretend to be a new user</span>
git config user.name <span class="s2">"Travis CI"</span>
git config user.email <span class="s2">"travis@travis-ci.org"</span>

<span class="c"># Add changes and commit.</span>
git add .
git commit -m <span class="s2">"Deploy with Travis CI"</span>

<span class="c"># Push from the current repo's master branch to the remote</span>
<span class="c"># repo's master branch. We redirect any output to</span>
<span class="c"># /dev/null to hide any sensitive credential data that might otherwise be exposed.</span>
git push --quiet <span class="s2">"https://</span><span class="k">${</span><span class="nv">GH_TOKEN</span><span class="k">}</span><span class="s2">@github.com/P4R/p4r.github.io.git"</span> master &gt; /dev/null 2&gt;&amp;1</code></pre></figure>

<p>Una vez todo configurado para comprobar que funciona simplemente tendremos que hacer push a nuestro
repositorio y desde la web de Travis podremos ver como se va ejecutando el código y si todo va bien
se publicará en la rama correspondiente.</p>


  </div>

  
    
    <x-chip href="/tag/travis/">Travis</x-chip>
  
    
    <x-chip href="/tag/github/">Github</x-chip>
  

  <hr/>

    <div class="share section">
    <a href="https://facebook.com/sharer.php?u=http://albujer.com/blog/2016/05/08/deploy-github-pages-with-travis/" rel="nofollow" target="_blank" title="Share on Facebook">
      <paper-icon-button icon="fa:facebook"></paper-icon-button></a>
    <a href="https://twitter.com/intent/tweet?text=Publicar web con Travis CI&url=http://albujer.com/blog/2016/05/08/deploy-github-pages-with-travis/&via=P4R93&related=P4R93" rel="nofollow" target="_blank" title="Share on Twitter">
      <paper-icon-button icon="fa:twitter"></paper-icon-button></a>
    <a href="https://plus.google.com/share?url=http://albujer.com/blog/2016/05/08/deploy-github-pages-with-travis/" rel="nofollow" target="_blank" title="Share on Google+">
      <paper-icon-button icon="fa:google-plus"></paper-icon-button></a>
    <a href="http://www.linkedin.com/shareArticle?mini=true&url=http://albujer.com/blog/2016/05/08/deploy-github-pages-with-travis/&title=Publicar web con Travis CI&summary=&source=http://albujer.com" rel="nofollow" target="_blank" title="Share on LinkedIn">
      <paper-icon-button icon="fa:linkedin"></paper-icon-button></a>
    <a href="http://www.reddit.com/submit?url=http://albujer.com/blog/2016/05/08/deploy-github-pages-with-travis/&title=Publicar web con Travis CI" rel="nofollow" target="_blank" title="Share on Reddit">
      <paper-icon-button icon="fa:reddit"></paper-icon-button></a>
    <a href="http://www.tumblr.com/share/link?url=http://albujer.com/blog/2016/05/08/deploy-github-pages-with-travis/&name={[ page.title }}&description=" rel="nofollow" target="_blank" title="Share on Tumblr">
      <paper-icon-button icon="fa:tumblr"></paper-icon-button></a>
  </div>

  <div class="section">
    
    <a href="/blog/2016/05/03/internet-security/"><paper-button raised class="accent">
      <iron-icon icon="arrow-back"></iron-icon> Anterior
    </paper-button></a>
    

    
      <paper-button raised disabled>
        Siguiente <iron-icon icon="arrow-forward"></iron-icon>
      </paper-button>
    
  </div>

  

</div>
</div>

    </paper-scroll-header-panel>
  </paper-drawer-panel>

  <paper-toast id="toast">
    <span class="toast-hide-button" role="button" tabindex="0" onclick="app.$.toast.hide()">Ok</span>
  </paper-toast>

</template>

<!-- build:js scripts/app.js -->
<script async src="/scripts/app.js"></script>
<!-- endbuild-->


	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','/scripts/g-analyt.js','ga');
		
		ga('create', 'UA-75892687-1', 'auto');
		ga('send', 'pageview');
	</script>
	<!-- End Google Analytics -->



</body>

</html>
